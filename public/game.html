<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒˆãƒ­ãƒƒã‚³ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ  (ITãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç‰¹åŒ–)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdn.socket.io/4.5.1/socket.io.esm.min.js" type="module"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #333; }
        canvas { display: block; }
        #quiz-overlay {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            font-family: 'Helvetica Neue', sans-serif;
            z-index: 10;
        }
        #top-info {
            position: absolute;
            top: 5vh;
            width: 100%;
            text-align: center;
        }
        #timer {
            font-size: 80px;
            font-weight: bold;
            color: #ff5722; 
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }
        #question-box {
            background: rgba(40, 44, 52, 0.9);
            color: white;
            padding: 20px;
            margin: 3vh auto 0;
            border-radius: 15px;
            max-width: 90%;
            border: 3px solid #ffcc00;
            font-size: 32px;
            line-height: 1.6;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .option-container {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            font-size: 28px;
        }
        .option {
            padding: 10px 20px;
            margin: 0 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            transition: background-color 0.3s, color 0.3s;
        }
        .selected {
            background-color: rgba(255, 204, 0, 0.7); 
            color: #333;
            font-weight: bold;
        }
        .correct-result { background-color: rgba(76, 175, 80, 0.8); color: white; }
        .incorrect-result { background-color: rgba(244, 67, 54, 0.8); color: white; }

        /* é€²è·¯é¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä½ç½®ã‚’èª¿æ•´ */
        #message {
            position: absolute;
            bottom: 20vh; /* ç”»é¢ä¸‹ã‹ã‚‰20%ã®ä½ç½®ã«å›ºå®š */
            width: 100%;
            text-align: center;
            font-size: 48px;
            font-weight: 900;
            color: #00bcd4;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
        }
        
        /* --- ãƒ©ã‚¤ãƒ•è¡¨ç¤ºã¨ã‚¬ã‚¤ãƒ‰ --- */
        #status-area {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            color: white;
            z-index: 15;
        }
        #life {
            font-size: 36px;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }
        .heart { color: #f44336; margin-left: 5px; } 
        #instructions {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 16px;
            border: 2px solid #ffcc00;
        }
        .instruction-control { font-weight: bold; color: #ffcc00; }

        /* ç¢ºå®šå¾Œã®çµæœã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #result-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-weight: 900;
            text-shadow: 4px 4px 10px rgba(0, 0, 0, 0.9);
        }
        .result-correct { 
            animation: flash-green 0.15s ease-out 4;
            background: rgba(76, 175, 80, 0.95);
        }
        .result-message { 
            font-size: 120px; 
            animation: pulse-message 0.5s ease-in-out infinite alternate;
        }
        .result-answer { font-size: 40px; margin-top: 10px; }

        @keyframes flash-green {
            0% { background-color: rgba(76, 175, 80, 0.95); }
            50% { background-color: rgba(0, 0, 0, 0.7); }
            100% { background-color: rgba(76, 175, 80, 0.95); }
        }
        @keyframes pulse-message {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        .damage-effect { animation: flash-red 0.3s ease-in-out 3; }
        @keyframes flash-red {
            0% { background-color: transparent; }
            50% { background-color: rgba(255, 0, 0, 0.4); }
            100% { background-color: transparent; }
        }

        .result-final-clear {
            background: radial-gradient(circle at center, rgba(255, 223, 0, 0.95), rgba(255, 140, 0, 0.8));
            animation: golden-glow 1s infinite alternate;
        }
        .result-final-clear .result-message {
            font-size: 150px;
            color: #a00;
            text-shadow: 0 0 20px #ffcc00, 0 0 30px #ff8800;
        }
        .result-final-clear .result-answer {
             color: #333;
             font-weight: bold;
        }
        @keyframes golden-glow {
            from { box-shadow: 0 0 50px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 80px rgba(255, 140, 0, 0.8); }
        }

        /* ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ */
        #gameover-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            z-index: 100;
        }
        #gameover-title { font-size: 80px; font-weight: 900; color: #f44336; margin-bottom: 30px; }
        #retry-message { font-size: 30px; margin-bottom: 20px; }
        #shake-gauge-container { width: 80%; max-width: 500px; height: 30px; background: #555; border-radius: 15px; overflow: hidden; border: 2px solid white; }
        #shake-gauge { height: 100%; width: 0%; background: linear-gradient(90deg, #ffcc00, #ff5722); transition: width 0.1s; }
        
        /* é–‹å§‹å¾…æ©Ÿç”»é¢ */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            z-index: 50;
        }
        .start-title { font-size: 60px; margin-bottom: 20px; color: #ffcc00; }
        .start-instruction { font-size: 30px; margin-bottom: 10px; }
        .start-highlight { color: #00bcd4; font-weight: bold; }

    </style>
</head>
<body>
    <div id="quiz-overlay">
        <div id="top-info">
            <div id="timer"></div>
            <div id="question-box">
                <div id="question"></div>
                <div class="option-container">
                    <span id="left-option" class="option"></span>
                    <span id="right-option" class="option"></span>
                </div>
            </div>
            </div>
        
        <div id="message"></div>

        <div id="status-area">
            <div id="life"></div>
            <div id="instructions">
                ğŸ•¹ï¸ **æ“ä½œã‚¬ã‚¤ãƒ‰**<br>
                <span class="instruction-control">**å‚¾ã‘ã‚‹**</span>: é€²è·¯ã‚’é¸æŠ<br>
                <span class="instruction-control">**æŒ¯ã‚‹**</span>: é€²è·¯ã‚’ç¢ºå®šï¼
            </div>
        </div>
    </div>

    <div id="result-overlay">
        <div class="result-message"></div>
        <div class="result-answer"></div>
        <div id="secret-hint" style="font-size: 24px; color: #333; margin-top: 30px; background: rgba(255, 255, 255, 0.7); padding: 10px; border-radius: 5px; display: none;"></div>
        <div id="result-retry-message" style="font-size: 30px; color: #333; margin-top: 30px; font-weight: bold; display: none;">ã‚¹ãƒãƒ›ã‚’æŒ¯ã£ã¦ãƒªãƒˆãƒ©ã‚¤ï¼</div>
    </div>
    
    <div id="start-screen">
        <div class="start-title">ãƒˆãƒ­ãƒƒã‚³ãƒ»ã‚µãƒã‚¤ãƒãƒ«ãƒ»ã‚¯ã‚¤ã‚ºï¼</div>
        <div id="mode-display" class="start-instruction">é›£æ˜“åº¦: <span class="start-highlight" style="color: #4CAF50;">ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«</span></div>
        <div class="start-instruction">ğŸš¨ <span class="start-highlight">ITãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤</span> ã«æŒ‘æˆ¦ï¼</div>
        <div class="start-instruction">**æ“ä½œæ–¹æ³•**</div>
        <div class="start-instruction"><span class="start-highlight">â‘  å‚¾ã‘ã‚‹</span>ï¼šã‚¹ãƒãƒ›ã‚’å·¦å³ã«å‚¾ã‘ã¦é¸æŠè‚¢ã‚’é¸ã³ã¾ã™ã€‚</div>
        <div class="start-instruction"><span class="start-highlight">â‘¡ æŒ¯ã‚‹</span>ï¼šé¸æŠã‚’ç¢ºå®šã—ã¾ã™ã€‚</div>
        <div style="height: 30px;"></div>
        <div class="start-title">æº–å‚™ãŒã§ããŸã‚‰ã€<span class="start-highlight">ã‚¹ãƒãƒ›ã‚’ä¸€å›æŒ¯ã£ã¦</span>ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</div>
    </div>

    <div id="gameover-screen">
        <div id="gameover-title">GAME OVER</div>
        <div id="gameover-score"></div>
        <div id="retry-message">å†æŒ‘æˆ¦ï¼ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’æŒ¯ã£ã¦ã‚²ãƒ¼ã‚¸ã‚’æº€ã‚¿ãƒ³ã«ã›ã‚ˆï¼</div>
        <div id="shake-gauge-container"><div id="shake-gauge"></div></div>
    </div>

    <script type="module">
        import { io } from "https://cdn.socket.io/4.5.1/socket.io.esm.min.js";
        
        const socket = io();
        socket.emit('join', 'game'); 

        let currentGamma = 0; 
        let currentZ = 0;     
        let lastZ = 0;
        const SHAKE_THRESHOLD = 15;
        let isShakeDetected = false;
        let shakeCount = 0; 
        
        // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºç”¨
        const SECRET_COMMAND_SEQUENCE = ['R', 'L', 'R']; // å³ã€å·¦ã€å³
        let secretCommandLog = [];
        const SECRET_COMMAND_THRESHOLD = 15; // ã‚¬ãƒ³ãƒå€¤ã®é–¾å€¤

        // UIè¦ç´ ã®å‚ç…§
        const leftOptionEl = document.getElementById('left-option');
        const rightOptionEl = document.getElementById('right-option');
        const resultOverlayEl = document.getElementById('result-overlay');
        const resultMsgEl = resultOverlayEl.querySelector('.result-message');
        const resultAnsEl = resultOverlayEl.querySelector('.result-answer');
        const topInfoEl = document.getElementById('top-info');
        const lifeEl = document.getElementById('life');
        const quizOverlayEl = document.getElementById('quiz-overlay');
        const gameoverScreenEl = document.getElementById('gameover-screen');
        const shakeGaugeEl = document.getElementById('shake-gauge');
        const gameoverScoreEl = document.getElementById('gameover-score');
        const startScreenEl = document.getElementById('start-screen');
        const secretHintEl = document.getElementById('secret-hint');
        const resultRetryMsgEl = document.getElementById('result-retry-message');
        const modeDisplayEl = document.getElementById('mode-display');
        const messageEl = document.getElementById('message');

        // Socket.IOã‹ã‚‰ã®ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å—ä¿¡
        socket.on('sensor', (data) => {
            currentGamma = parseFloat(data.g); 
            currentZ = parseFloat(data.z);     
            
            // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰ã®ãƒ­ã‚°è¨˜éŒ² (WAITINGæ™‚ã®ã¿)
            if (game.state === 'WAITING') {
                logSecretCommandDirection(currentGamma);
            }
            
            // ã‚·ã‚§ã‚¤ã‚¯æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
            if (Math.abs(currentZ - lastZ) > SHAKE_THRESHOLD && !isShakeDetected) {
                isShakeDetected = true;
                if (game.state === 'GAMEOVER') {
                    handleRetryShake();
                } else if (game.state === 'WAITING') {
                    handleStartShake();
                } else if (game.state === 'RESULT') {
                    handleResultShake(); // ã‚´ãƒ¼ãƒ«å¾Œã®ãƒªãƒˆãƒ©ã‚¤ã¯æœ€åˆã®ç”»é¢ã«æˆ»ã‚‹
                } else {
                    handleShake();
                }
                setTimeout(() => { isShakeDetected = false; }, 500); 
            }
            lastZ = currentZ;
        });

        // ----------------------------------------------------
        // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
        // ----------------------------------------------------
        function logSecretCommandDirection(gamma) {
            let direction = null;
            if (gamma > SECRET_COMMAND_THRESHOLD) {
                direction = 'R';
            } else if (gamma < -SECRET_COMMAND_THRESHOLD) {
                direction = 'L';
            }
            
            if (direction) {
                if (secretCommandLog.length === 0 || secretCommandLog[secretCommandLog.length - 1] !== direction) {
                    secretCommandLog.push(direction);
                    
                    if (secretCommandLog.length > SECRET_COMMAND_SEQUENCE.length * 2) {
                        secretCommandLog = [];
                    }

                    if (secretCommandLog.slice(-SECRET_COMMAND_SEQUENCE.length).join('') === SECRET_COMMAND_SEQUENCE.join('')) {
                        if (!game.isHardMode) {
                            game.toggleHardMode();
                        }
                        secretCommandLog = []; 
                    }
                }
            }
        }
        
        function handleRetryShake() {
            const GAUGE_MAX = 5; 
            shakeCount = Math.min(GAUGE_MAX, shakeCount + 1);
            shakeGaugeEl.style.width = `${(shakeCount / GAUGE_MAX) * 100}%`;

            if (shakeCount >= GAUGE_MAX) {
                game.initGame(); // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒªãƒˆãƒ©ã‚¤ã‚‚æœ€åˆã®ç”»é¢ã¸
            }
        }
        
        function handleStartShake() {
             game.state = 'ASKING';
             startScreenEl.style.display = 'none';
             game.nextQuestion();
        }

        function handleResultShake() {
            // ã‚´ãƒ¼ãƒ«å¾Œã®ã‚·ã‚§ã‚¤ã‚¯ã¯æœ€åˆã®ç”»é¢ã«æˆ»ã‚‹
             game.initGame();
        }
        
        function handleShake() {
             if (game) game.handleShake();
        }

        // ----------------------------------------------------
        // p5.js ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨æç”»
        // ----------------------------------------------------

        let game;
        
        window.setup = function() {
            createCanvas(windowWidth, windowHeight, WEBGL);
            angleMode(DEGREES);
            game = new TrocoQuizGame();
        }

        window.draw = function() {
            game.update();
            game.display();
        }

        window.windowResized = function() {
            resizeCanvas(windowWidth, windowHeight);
        }

        /**
         * ãƒˆãƒ­ãƒƒã‚³ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹
         */
        class TrocoQuizGame {
            constructor() {
                // å•é¡Œã‚¹ãƒˆãƒƒã‚¯ï¼ˆåˆè¨ˆ30å•ï¼‰
                this.normalQuestions = [
                    // ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆåŸºç¤çŸ¥è­˜ï¼‰- è¨ˆ15å•
                    { q: "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒç†è§£ã§ãã‚‹è¨€èªã¯ï¼Ÿ", options: ["Python", "æ©Ÿæ¢°èª"], correct: "æ©Ÿæ¢°èª" },
                    { q: "Webãƒšãƒ¼ã‚¸ã«ä½¿ã‚ã‚Œã‚‹ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã¯ï¼Ÿ", options: ["Java", "HTML"], correct: "HTML" },
                    { q: "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªæ‰‹é †ã‚’å®šã‚ãŸã‚‚ã®ã¯ï¼Ÿ", options: ["ãƒ—ãƒ­ãƒˆã‚³ãƒ«", "ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ "], correct: "ãƒ—ãƒ­ãƒˆã‚³ãƒ«" },
                    { q: "ãƒ‡ãƒ¼ã‚¿ã®ä¸¦ã¹æ›¿ãˆå‡¦ç†ã‚’ä½•ã¨ã„ã†ã‹ï¼Ÿ", options: ["ã‚½ãƒ¼ãƒˆ", "ãƒªãƒãƒ¼ã‚¹"], correct: "ã‚½ãƒ¼ãƒˆ" },
                    { q: "ãƒ‡ãƒ¼ã‚¿ã‚’æ”¹ã–ã‚“ã‹ã‚‰å®ˆã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸã‚‚ã®ã¯ï¼Ÿ", options: ["æ©Ÿå¯†æ€§", "å®Œå…¨æ€§"], correct: "å®Œå…¨æ€§" },
                    { q: "ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æ„å‘³ã™ã‚‹ç•¥èªã¯ï¼Ÿ", options: ["PaaS", "SaaS"], correct: "SaaS" },
                    { q: "1ãƒã‚¤ãƒˆã¯ä½•ãƒ“ãƒƒãƒˆã‹ï¼Ÿ", options: ["4ãƒ“ãƒƒãƒˆ", "8ãƒ“ãƒƒãƒˆ"], correct: "8ãƒ“ãƒƒãƒˆ" },
                    { q: "ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¸€è¡Œãšã¤å®Ÿè¡Œã—ã€ãƒã‚°ã‚’è¦‹ã¤ã‘ã‚‹æ‰‹æ³•ã¯ï¼Ÿ", options: ["ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«", "ãƒ‡ãƒãƒƒã‚°"], correct: "ãƒ‡ãƒãƒƒã‚°" },
                    { q: "ãƒ‡ãƒ¼ã‚¿ã®æ©Ÿå¯†æ€§ã€å®Œå…¨æ€§ã€å¯ç”¨æ€§ã®é ­æ–‡å­—ã‚’å–ã£ãŸç•¥èªã¯ï¼Ÿ", options: ["QoS", "CIA"], correct: "CIA" },
                    { q: "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ä½æ‰€ã«ã‚ãŸã‚‹ã‚‚ã®ã¯ï¼Ÿ", options: ["ãƒ‰ãƒ¡ã‚¤ãƒ³å", "IPã‚¢ãƒ‰ãƒ¬ã‚¹"], correct: "IPã‚¢ãƒ‰ãƒ¬ã‚¹" },
                    { q: "å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ãƒ»åˆ†æã™ã‚‹æŠ€è¡“ã¯ï¼Ÿ", options: ["ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿", "ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ‹ãƒ³ã‚°"], correct: "ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿" },
                    { q: "èªè¨¼ã«ãŠã„ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»¥å¤–ã«æŒ‡ç´‹ãªã©ã®ç”Ÿä½“æƒ…å ±ã‚’ç”¨ã„ã‚‹æ–¹æ³•ã¯ï¼Ÿ", options: ["å˜ä¸€èªè¨¼", "äºŒè¦ç´ èªè¨¼"], correct: "äºŒè¦ç´ èªè¨¼" },
                    { q: "ã‚µãƒ¼ãƒãƒ¼ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨ã®å°å…¥ãƒ»ç®¡ç†ãªã—ã«ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹å½¢æ…‹ã¯ï¼Ÿ", options: ["ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹", "ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°"], correct: "ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°" },
                    { q: "è‘—ä½œæ¨©ã§ä¿è­·ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç„¡æ–­ã§ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ã«å¯¾ã—ã¦ç”¨ã„ã‚‰ã‚Œã‚‹æ³•å¾‹ã¯ï¼Ÿ", options: ["ç‹¬å ç¦æ­¢æ³•", "ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•"], correct: "ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•" },
                    { q: "ITã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™ºæ‰‹æ³•ã§ã€å°ã•ãªæ©Ÿèƒ½ã‚’çŸ­ã„ã‚µã‚¤ã‚¯ãƒ«ã§é–‹ç™ºãƒ»æ”¹å–„ã—ã¦ã„ãæ‰‹æ³•ã¯ï¼Ÿ", options: ["ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«é–‹ç™º", "ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™º"], correct: "ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«é–‹ç™º" },
                ];
                this.hardQuestions = [
                    // å¿œç”¨æƒ…å ±æŠ€è¡“è€…ãƒ¬ãƒ™ãƒ«ï¼ˆã‚ˆã‚Šæ·±ã„çŸ¥è­˜ï¼‰- è¨ˆ15å•
                    { q: "IPã‚¢ãƒ‰ãƒ¬ã‚¹æ¯æ¸‡å•é¡Œã‚’å—ã‘ã¦ç™»å ´ã—ãŸã€æ¬¡ä¸–ä»£ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ï¼Ÿ", options: ["IPv5", "IPv6"], correct: "IPv6" },
                    { q: "ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ã¨å‰Šé™¤ã‚’å…ˆå…¥ã‚Œå…ˆå‡ºã—ï¼ˆFIFOï¼‰ã§è¡Œã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ï¼Ÿ", options: ["ã‚¹ã‚¿ãƒƒã‚¯", "ã‚­ãƒ¥ãƒ¼"], correct: "ã‚­ãƒ¥ãƒ¼" },
                    { q: "ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œå‰ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒå¿…è¦ãªè¨€èªã¯ï¼Ÿ", options: ["Python", "Cè¨€èª"], correct: "Cè¨€èª" },
                    { q: "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã§ã€å†…éƒ¨æ§‹é€ ã‚’è¦‹ãšã«å¤–éƒ¨ä»•æ§˜ã‹ã‚‰æ¤œè¨¼ã™ã‚‹ã®ã¯ï¼Ÿ", options: ["ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹", "ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹"], correct: "ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹" },
                    { q: "ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ACIDç‰¹æ€§ã®ã†ã¡ã€å‡¦ç†ãŒå®Œäº†ã—ãŸã‚‰å…ƒã«æˆ»ã›ãªã„æ€§è³ªã¯ï¼Ÿ", options: ["ä¸€è²«æ€§ (Consistency)", "è€ä¹…æ€§ (Durability)"], correct: "è€ä¹…æ€§ (Durability)" },
                    { q: "ç„¡ç·šLANã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¨™æº–ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ï¼Ÿ", options: ["WPA2", "WPA3"], correct: "WPA3" },
                    { q: "RDBã«ãŠã„ã¦ã€ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®é–¢é€£ä»˜ã‘ã«ä½¿ã†ã‚­ãƒ¼ã¯ï¼Ÿ", options: ["ä¸»ã‚­ãƒ¼", "å¤–éƒ¨ã‚­ãƒ¼"], correct: "å¤–éƒ¨ã‚­ãƒ¼" },
                    { q: "ãƒ—ãƒ­ã‚»ãƒƒã‚µã®å‡¦ç†é€Ÿåº¦ã‚’è¡¨ã™å˜ä½ã§ã€1ç§’é–“ã«å®Ÿè¡Œã§ãã‚‹å‘½ä»¤æ•°ã‚’æ„å‘³ã™ã‚‹ç•¥èªã¯ï¼Ÿ", options: ["FLOPS", "MIPS"], correct: "MIPS" },
                    { q: "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é€šä¿¡é€Ÿåº¦ãŒä½ä¸‹ã™ã‚‹ç¾è±¡ã‚’æŒ‡ã™è¨€è‘‰ã¯ï¼Ÿ", options: ["ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆä½ä¸‹", "ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·å¢—åŠ "], correct: "ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆä½ä¸‹" },
                    { q: "ä»®æƒ³è¨˜æ†¶æ–¹å¼ã«ãŠã„ã¦ã€ãƒšãƒ¼ã‚¸ã‚¢ã‚¦ãƒˆãƒ»ãƒšãƒ¼ã‚¸ã‚¤ãƒ³ãŒé »ç¹ã«ç™ºç”Ÿã—ã€ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½ãŒæ¥µç«¯ã«ä½ä¸‹ã™ã‚‹ç¾è±¡ã¯ï¼Ÿ", options: ["ãƒ‡ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "ã‚¹ãƒ©ãƒƒã‚·ãƒ³ã‚°"], correct: "ã‚¹ãƒ©ãƒƒã‚·ãƒ³ã‚°" },
                    { q: "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã«ãŠã‘ã‚‹ã‚³ã‚¹ãƒˆãƒ»å·¥æ•°ã‚’è¦‹ç©ã‚‚ã‚‹æ‰‹æ³•ã®ä¸€ã¤ã§ã€éå»ã®é¡ä¼¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ã®ã¯ï¼Ÿ", options: ["COCOMOæ³•", "ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼æ³•"], correct: "ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼æ³•" },
                    { q: "ã‚·ã‚¹ãƒ†ãƒ ã®ä¿¡é ¼æ€§ã‚’è¡¨ã™æŒ‡æ¨™ã§ã€æ•…éšœã‹ã‚‰å¾©æ—§ã¾ã§ã®å¹³å‡æ™‚é–“ã‚’æ„å‘³ã™ã‚‹ç•¥èªã¯ï¼Ÿ", options: ["MTBF", "MTTR"], correct: "MTTR" },
                    { q: "é›¢æ•£çš„ãªå€¤ã‚’é€£ç¶šçš„ãªæ³¢å½¢ã§è¡¨ç¾ã™ã‚‹æ–¹å¼ã¯ï¼Ÿ", options: ["ãƒ‡ã‚¸ã‚¿ãƒ«", "ã‚¢ãƒŠãƒ­ã‚°"], correct: "ã‚¢ãƒŠãƒ­ã‚°" },
                    { q: "ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã¨ã—ã¦ã€ç‰¹å®šã®æ¥­å‹™ã‚„éƒ¨é–€ã«ç‰¹åŒ–ã—ãŸå°è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ï¼Ÿ", options: ["ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯", "ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒˆ"], correct: "ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒˆ" },
                    { q: "å…¬é–‹éµæš—å·æ–¹å¼ã§ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡è€…ãŒã€Œç§˜å¯†éµã€ã§æš—å·åŒ–ã—ã€å—ä¿¡è€…ãŒã€Œå…¬é–‹éµã€ã§å¾©å·ã—ã¦æœ¬äººç¢ºèªã‚’è¡Œã†æŠ€è¡“ã¯ï¼Ÿ", options: ["å…±é€šéµæš—å·", "ãƒ‡ã‚¸ã‚¿ãƒ«ç½²å"], correct: "ãƒ‡ã‚¸ã‚¿ãƒ«ç½²å" },
                ];
                
                this.isHardMode = false;
                this.questions = [];
                this.currentQuestionIndex = -1;
                this.state = 'INIT'; 
                this.score = 0;
                this.totalQuestions = 5; // ğŸ”¥ ã“ã“ã‚’5å•ã«æˆ»ã—ã¾ã—ãŸ
                this.life = 3; 
                this.questionStartTime = 0;
                this.timeLimit = 15; 
                
                this.selectedOption = null;
                this.correctOption = null; 
                this.trolleyZ = 0;
                this.trolleyRotation = 0; 
                this.trolleyRotationTarget = 0; 
                this.trolleyYOffset = 0; 
                this.trolleyYTarget = 0; 
                this.targetDirection = 0; 
                this.baseMoveSpeed = 0.5;
                this.currentMoveSpeed = this.baseMoveSpeed; 
                this.cameraZ = 0;
                this.damageTimer = 0; 
                
                this.updateLifeDisplay();
                this.selectRandomQuestions();
                this.initGame();
            }

            toggleHardMode() {
                this.isHardMode = !this.isHardMode;
                this.selectRandomQuestions();
                this.updateModeDisplay();
                
                startScreenEl.querySelector('.start-title').innerText = this.isHardMode ? "ğŸ”¥ è¶…é›£å•ãƒˆãƒ­ãƒƒã‚³ï¼ğŸ”¥" : "ãƒˆãƒ­ãƒƒã‚³ãƒ»ã‚µãƒã‚¤ãƒãƒ«ãƒ»ã‚¯ã‚¤ã‚ºï¼";
                startScreenEl.querySelector('.start-instruction:nth-child(3)').innerHTML = this.isHardMode ? 'ğŸš¨ <span class="start-highlight">å¿œç”¨æƒ…å ±æŠ€è¡“è€…ãƒ¬ãƒ™ãƒ«</span> ã®é›£å•ã«æŒ‘æˆ¦ï¼' : 'ğŸš¨ <span class="start-highlight">ITãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤</span> ã«æŒ‘æˆ¦ï¼';
                alert(this.isHardMode ? "è¶…é›£å•ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸï¼" : "ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸï¼");
            }
            
            updateModeDisplay() {
                const color = this.isHardMode ? '#f44336' : '#4CAF50';
                modeDisplayEl.innerHTML = `é›£æ˜“åº¦: <span class="start-highlight" style="color: ${color};">${this.isHardMode ? 'å¿œç”¨æƒ…å ±æŠ€è¡“è€…ãƒ¬ãƒ™ãƒ«' : 'ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«'}</span>`;
            }

            selectRandomQuestions() {
                const source = this.isHardMode ? this.hardQuestions : this.normalQuestions;
                // ã‚¹ãƒˆãƒƒã‚¯ãŒå¢—ãˆãŸã®ã§ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å¿…è¦ãªåˆ†ã ã‘é¸æŠ
                const shuffled = source.sort(() => 0.5 - Math.random());
                this.questions = shuffled.slice(0, this.totalQuestions);
            }

            initGame() {
                this.state = 'WAITING';
                this.hideGameoverScreen();
                this.hideResultOverlay();
                startScreenEl.style.display = 'flex';
                
                document.getElementById('timer').innerText = '';
                document.getElementById('question').innerText = '';
                messageEl.innerText = '';
                this.updateOptionDisplay(null, null);

                this.trolleyZ = 0;
                this.cameraZ = 150;
                this.score = 0;
                this.life = 3;
                this.currentQuestionIndex = -1;
                this.updateLifeDisplay();
                this.updateModeDisplay(); 
                
                secretCommandLog = []; 
            }

            startGame() {
                this.initGame(); 
            }

            updateLifeDisplay() {
                lifeEl.innerHTML = 'ãƒ©ã‚¤ãƒ•: ';
                for(let i = 0; i < 3; i++) {
                    lifeEl.innerHTML += `<span class="heart">${i < this.life ? 'â¤ï¸' : 'ğŸ¤'}</span>`;
                }
            }

            nextQuestion() {
                if (this.life <= 0) {
                    this.state = 'GAMEOVER';
                    this.showGameoverScreen();
                    return;
                }

                if (this.currentQuestionIndex >= this.totalQuestions - 1) {
                    this.state = 'RESULT';
                    this.showResultOverlay(true, true); 
                    return;
                }

                this.currentQuestionIndex++;
                const qData = this.questions[this.currentQuestionIndex];
                
                qData.options.sort(() => random() - 0.5);

                this.currentQuestion = qData;
                this.correctOption = qData.correct;
                this.selectedOption = null;
                this.targetDirection = 0;
                this.questionStartTime = millis();
                this.state = 'ASKING';
                messageEl.innerText = 'é€²è·¯ã‚’é¸æŠã—ã€æŒ¯ã£ã¦ç¢ºå®šï¼';
                this.updateQuestionDisplay();
                this.hideResultOverlay();
            }

            handleShake() {
                if (this.state === 'ASKING') {
                    this.state = 'MOVING';
                    
                    let selectionIndex = this.targetDirection === 1 ? 1 : 0;
                    if (this.targetDirection === 0) selectionIndex = 0; 
                    
                    this.selectedOption = this.currentQuestion.options[selectionIndex];

                    const isCorrect = this.selectedOption === this.correctOption;
                    if (isCorrect) {
                        this.score++;
                        this.currentMoveSpeed = this.baseMoveSpeed * 3; 
                    } else {
                        this.life--;
                        this.updateLifeDisplay();
                        this.damageTimer = 10; 
                        this.trolleyRotationTarget = random([-100, 100]); 
                    }
                    
                    this.showResultOverlay(isCorrect);

                    const selectedIndex = selectionIndex;
                    this.trolleyRotationTarget = selectedIndex === 1 ? 60 : -60; 

                    setTimeout(() => {
                        this.currentMoveSpeed = this.baseMoveSpeed; 
                        this.trolleyRotationTarget = 0;
                        this.nextQuestion();
                    }, 3000);
                }
            }

            showResultOverlay(isCorrect, isClear = false) {
                topInfoEl.style.display = 'none'; 
                resultOverlayEl.style.display = 'flex';
                
                if (isClear) {
                    resultOverlayEl.className = 'result-final-clear';
                    resultMsgEl.innerText = this.isHardMode ? 'ğŸ‘‘ ä¼èª¬é”æˆï¼ğŸ†' : 'âœ¨ å…¨å•ã‚¯ãƒªã‚¢ï¼âœ¨';
                    resultAnsEl.innerHTML = `æœ€çµ‚ã‚¹ã‚³ã‚¢: ${this.score}/${this.totalQuestions}`;
                    
                    if (!this.isHardMode) {
                        secretHintEl.style.display = 'block';
                        secretHintEl.innerHTML = `ã€éš ã—è¦ç´ ã€‘æœ€åˆã®ç”»é¢ã§ã€Œå³â†’å·¦â†’å³ã€ã®é †ã«ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã‚‹ã¨...ï¼Ÿ`;
                    } else {
                        secretHintEl.style.display = 'none';
                    }

                    resultRetryMsgEl.style.display = 'block';
                } else {
                    resultOverlayEl.className = isCorrect ? 'result-correct' : 'result-incorrect';
                    resultMsgEl.innerText = isCorrect ? 'ğŸ‰ å¤§æ­£è§£ï¼' : 'âŒ ä¸æ­£è§£...';
                    resultAnsEl.innerHTML = `ã‚ãªãŸã®é¸æŠ: ${this.selectedOption || 'æœªç¢ºå®š'} <br> æ­£è§£: ${this.correctOption}`;
                    secretHintEl.style.display = 'none';
                    resultRetryMsgEl.style.display = 'none';
                    
                    if (!isCorrect) {
                        quizOverlayEl.classList.add('damage-effect');
                    } else {
                        quizOverlayEl.classList.remove('damage-effect');
                    }
                }
            }

            hideResultOverlay() {
                topInfoEl.style.display = 'block';
                resultOverlayEl.style.display = 'none';
                quizOverlayEl.classList.remove('damage-effect');
                secretHintEl.style.display = 'none';
                resultRetryMsgEl.style.display = 'none';
            }

            showGameoverScreen() {
                gameoverScreenEl.style.display = 'flex';
                gameoverScoreEl.innerHTML = `ã‚¹ã‚³ã‚¢: ${this.score}/${this.totalQuestions} (ãƒ¢ãƒ¼ãƒ‰: ${this.isHardMode ? 'å¿œç”¨æƒ…å ±æŠ€è¡“è€…ãƒ¬ãƒ™ãƒ«' : 'ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«'})`;
                shakeCount = 0;
                shakeGaugeEl.style.width = '0%';
            }

            hideGameoverScreen() {
                gameoverScreenEl.style.display = 'none';
            }

            clearOptionHighlight() {
                leftOptionEl.className = 'option';
                rightOptionEl.className = 'option';
            }

            updateQuestionDisplay() {
                if (!this.currentQuestion) return;
                document.getElementById('question').innerHTML = `Q${this.currentQuestionIndex + 1}/${this.totalQuestions}: ${this.currentQuestion.q}`;
                this.updateOptionDisplay(this.currentQuestion.options[0], this.currentQuestion.options[1]);
            }

            updateOptionDisplay(left, right) {
                leftOptionEl.innerText = 'â† ' + (left || '');
                rightOptionEl.innerText = (right || '') + ' â†’';
                
                if (this.state === 'WAITING' || this.state === 'RESULT' || this.state === 'GAMEOVER') {
                    leftOptionEl.innerText = '';
                    rightOptionEl.innerText = '';
                }
            }

            update() {
                if (this.state === 'GAMEOVER' || this.state === 'WAITING' || this.state === 'RESULT') return;

                if (this.damageTimer > 0) {
                    this.damageTimer--;
                    this.trolleyRotation = random([-30, 30]); 
                } else {
                    const currentSpeed = this.currentMoveSpeed * (this.state === 'MOVING' ? 1.5 : 1);
                    this.trolleyZ -= currentSpeed;
                    this.cameraZ = lerp(this.cameraZ, this.trolleyZ + 200, 0.1); 
                    
                    this.trolleyYTarget = sin(this.trolleyZ * 2) * 2; 
                    this.trolleyYOffset = lerp(this.trolleyYOffset, this.trolleyYTarget, 0.2);
                }


                if (this.state === 'ASKING') {
                    // ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†
                    const elapsedTime = (millis() - this.questionStartTime) / 1000;
                    const remainingTime = max(0, this.timeLimit - floor(elapsedTime));
                    document.getElementById('timer').innerText = remainingTime;

                    if (remainingTime <= 0) {
                        this.state = 'MOVING'; 
                        this.life--;
                        this.updateLifeDisplay();
                        messageEl.innerText = 'â° ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼ä¸æ­£è§£';
                        this.showResultOverlay(false);
                        this.damageTimer = 10;
                        this.trolleyRotationTarget = 0;
                        setTimeout(() => {
                            this.currentMoveSpeed = this.baseMoveSpeed;
                            this.nextQuestion();
                        }, 3000);
                    }
                    
                    // å‚¾ãã«ã‚ˆã‚‹æ–¹å‘æ±ºå®šã¨ãƒˆãƒ­ãƒƒã‚³ã®å›è»¢ (è¦–è¦šçš„ãªé€£å‹•)
                    if (currentGamma > 15) { 
                        this.targetDirection = 1; 
                        this.trolleyRotationTarget = 15; 
                    } else if (currentGamma < -15) { 
                        this.targetDirection = -1; 
                        this.trolleyRotationTarget = -15; 
                    } else {
                        this.targetDirection = 0; 
                        this.trolleyRotationTarget = 0;
                    }

                    // UIã®é¸æŠå¼·èª¿
                    this.clearOptionHighlight();
                    if (this.targetDirection === -1) {
                        leftOptionEl.classList.add('selected');
                    } else if (this.targetDirection === 1) {
                        rightOptionEl.classList.add('selected');
                    }
                } else if (this.state === 'MOVING') {
                    // ç¢ºå®šå¾Œã®UIãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    const leftOption = this.currentQuestion.options[0];
                    const rightOption = this.currentQuestion.options[1];
                    const isCorrect = this.selectedOption === this.correctOption;

                    this.clearOptionHighlight();
                    if (this.selectedOption === leftOption) {
                        leftOptionEl.classList.add(isCorrect ? 'correct-result' : 'incorrect-result');
                    } else if (this.selectedOption === rightOption) {
                        rightOptionEl.classList.add(isCorrect ? 'correct-result' : 'incorrect-result');
                    }
                }
                
                if (this.damageTimer <= 0) {
                     this.trolleyRotation = lerp(this.trolleyRotation, this.trolleyRotationTarget, 0.1);
                }
            }

            display() {
                background(30, 40, 70); 

                camera(0, -50, this.cameraZ, 
                       0, 0, this.trolleyZ,
                       0, 1, 0);

                directionalLight(200, 200, 255, 0, 1, 0);
                pointLight(255, 100, 0, 0, 0, this.trolleyZ - 100); 

                this.drawRails();

                // ãƒˆãƒ­ãƒƒã‚³ã‚’æç”»
                push();
                translate(0, this.trolleyYOffset + 15, this.trolleyZ); 
                rotateZ(this.trolleyRotation);
                this.drawTrolley();
                pop();
            }

            drawTrolley() {
                // ãƒˆãƒ­ãƒƒã‚³ã®æå†™ã‚µã‚¤ã‚ºã‚’ç´„1.3å€ã«æ‹¡å¤§
                const scaleFactor = 1.3;
                const baseWidth = 45 * scaleFactor;
                const baseHeight = 22 * scaleFactor;
                const baseDepth = 75 * scaleFactor;

                // ãƒˆãƒ­ãƒƒã‚³ã®ãƒ™ãƒ¼ã‚¹
                specularMaterial(150, 75, 0); 
                box(baseWidth, baseHeight, baseDepth);

                // ãƒˆãƒ­ãƒƒã‚³ã®åº§å¸­
                specularMaterial(50); 
                translate(0, -15 * scaleFactor, 0); 
                box(baseWidth * 0.7, 8 * scaleFactor, baseDepth * 0.8);
                
                // è»Šè¼ª 
                specularMaterial(100);
                const wheelRadius = 8 * scaleFactor; 
                const wheelRotation = (this.trolleyZ * 0.5) * 50; 

                for (let i = -1; i <= 1; i += 2) {
                    for (let j = -1; j <= 1; j += 2) {
                        push();
                        translate(i * (baseWidth / 2 + 2 * scaleFactor), 15 * scaleFactor, j * (baseDepth / 2 - 5 * scaleFactor)); 
                        rotateX(90);
                        rotateZ(wheelRotation); 
                        cylinder(wheelRadius, 8 * scaleFactor); 
                        pop();
                    }
                }
            }
            
            drawRails() {
                specularMaterial(100); 
                const railWidth = 5;
                const railHeight = 5;
                const railSpacing = 30; 
                const renderDistance = 1000;
                
                // æ•æœ¨
                specularMaterial(150, 75, 0);
                for (let z = this.trolleyZ + 10; z > this.trolleyZ - renderDistance; z -= 30) {
                    push();
                    translate(0, railHeight / 2, z);
                    box(railSpacing * 2.5, railHeight, 5); 
                    pop();
                }
                
                // ãƒ¬ãƒ¼ãƒ«
                specularMaterial(100);
                for (let i = -1; i <= 1; i += 2) {
                    push();
                    translate(i * railSpacing, railHeight, this.trolleyZ - renderDistance / 2);
                    box(railWidth, railHeight * 2, renderDistance);
                    pop();
                }
            }
        }
    </script>
</body>
</html>